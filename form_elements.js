const country_phone_match = [
    {phone_code: "93", country_code: "AF"},
    {phone_code: "355", country_code: "AL"},
    {phone_code: "213", country_code: "DZ"},
    {phone_code: "1-684", country_code: "AS"},
    {phone_code: "376", country_code: "AD"},
    {phone_code: "244", country_code: "AO"},
    {phone_code: "1-264", country_code: "AI"},
    {phone_code: "672", country_code: "AQ"},
    {phone_code: "1-268", country_code: "AG"},
    {phone_code: "54", country_code: "AR"},
    {phone_code: "374", country_code: "AM"},
    {phone_code: "297", country_code: "AW"},
    {phone_code: "61", country_code: "AU"},
    {phone_code: "43", country_code: "AT"},
    {phone_code: "994", country_code: "AZ"},
    {phone_code: "1-242", country_code: "BS"},
    {phone_code: "973", country_code: "BH"},
    {phone_code: "880", country_code: "BD"},
    {phone_code: "1-246", country_code: "BB"},
    {phone_code: "375", country_code: "BY"},
    {phone_code: "32", country_code: "BE"},
    {phone_code: "501", country_code: "BZ"},
    {phone_code: "229", country_code: "BJ"},
    {phone_code: "1-441", country_code: "BM"},
    {phone_code: "975", country_code: "BT"},
    {phone_code: "591", country_code: "BO"},
    {phone_code: "387", country_code: "BA"},
    {phone_code: "267", country_code: "BW"},
    {phone_code: "55", country_code: "BR"},
    {phone_code: "246", country_code: "IO"},
    {phone_code: "1-284", country_code: "VG"},
    {phone_code: "673", country_code: "BN"},
    {phone_code: "359", country_code: "BG"},
    {phone_code: "226", country_code: "BF"},
    {phone_code: "257", country_code: "BI"},
    {phone_code: "855", country_code: "KH"},
    {phone_code: "237", country_code: "CM"},
    {phone_code: "1", country_code: "CA"},
    {phone_code: "238", country_code: "CV"},
    {phone_code: "1-345", country_code: "KY"},
    {phone_code: "236", country_code: "CF"},
    {phone_code: "235", country_code: "TD"},
    {phone_code: "56", country_code: "CL"},
    {phone_code: "86", country_code: "CN"},
    {phone_code: "61", country_code: "CX"},
    {phone_code: "61", country_code: "CC"},
    {phone_code: "57", country_code: "CO"},
    {phone_code: "269", country_code: "KM"},
    {phone_code: "682", country_code: "CK"},
    {phone_code: "506", country_code: "CR"},
    {phone_code: "385", country_code: "HR"},
    {phone_code: "53", country_code: "CU"},
    {phone_code: "599", country_code: "CW"},
    {phone_code: "357", country_code: "CY"},
    {phone_code: "420", country_code: "CZ"},
    {phone_code: "243", country_code: "CD"},
    {phone_code: "45", country_code: "DK"},
    {phone_code: "253", country_code: "DJ"},
    {phone_code: "1-767", country_code: "DM"},
    {phone_code: "1-809", country_code: "DO"},
    {phone_code: "670", country_code: "TL"},
    {phone_code: "593", country_code: "EC"},
    {phone_code: "20", country_code: "EG"},
    {phone_code: "503", country_code: "SV"},
    {phone_code: "240", country_code: "GQ"},
    {phone_code: "291", country_code: "ER"},
    {phone_code: "372", country_code: "EE"},
    {phone_code: "251", country_code: "ET"},
    {phone_code: "500", country_code: "FK"},
    {phone_code: "298", country_code: "FO"},
    {phone_code: "679", country_code: "FJ"},
    {phone_code: "358", country_code: "FI"},
    {phone_code: "33", country_code: "FR"},
    {phone_code: "689", country_code: "PF"},
    {phone_code: "241", country_code: "GA"},
    {phone_code: "220", country_code: "GM"},
    {phone_code: "995", country_code: "GE"},
    {phone_code: "49", country_code: "DE"},
    {phone_code: "233", country_code: "GH"},
    {phone_code: "350", country_code: "GI"},
    {phone_code: "30", country_code: "GR"},
    {phone_code: "299", country_code: "GL"},
    {phone_code: "1-473", country_code: "GD"},
    {phone_code: "1-671", country_code: "GU"},
    {phone_code: "502", country_code: "GT"},
    {phone_code: "44-1481", country_code: "GG"},
    {phone_code: "224", country_code: "GN"},
    {phone_code: "245", country_code: "GW"},
    {phone_code: "592", country_code: "GY"},
    {phone_code: "509", country_code: "HT"},
    {phone_code: "504", country_code: "HN"},
    {phone_code: "852", country_code: "HK"},
    {phone_code: "36", country_code: "HU"},
    {phone_code: "354", country_code: "IS"},
    {phone_code: "91", country_code: "IN"},
    {phone_code: "62", country_code: "ID"},
    {phone_code: "98", country_code: "IR"},
    {phone_code: "964", country_code: "IQ"},
    {phone_code: "353", country_code: "IE"},
    {phone_code: "44-1624", country_code: "IM"},
    {phone_code: "972", country_code: "IL"},
    {phone_code: "39", country_code: "IT"},
    {phone_code: "225", country_code: "CI"},
    {phone_code: "1-876", country_code: "JM"},
    {phone_code: "81", country_code: "JP"},
    {phone_code: "44-1534", country_code: "JE"},
    {phone_code: "962", country_code: "JO"},
    {phone_code: "7", country_code: "KZ"},
    {phone_code: "254", country_code: "KE"},
    {phone_code: "686", country_code: "KI"},
    {phone_code: "383", country_code: "XK"},
    {phone_code: "965", country_code: "KW"},
    {phone_code: "996", country_code: "KG"},
    {phone_code: "856", country_code: "LA"},
    {phone_code: "371", country_code: "LV"},
    {phone_code: "961", country_code: "LB"},
    {phone_code: "266", country_code: "LS"},
    {phone_code: "231", country_code: "LR"},
    {phone_code: "218", country_code: "LY"},
    {phone_code: "423", country_code: "LI"},
    {phone_code: "370", country_code: "LT"},
    {phone_code: "352", country_code: "LU"},
    {phone_code: "853", country_code: "MO"},
    {phone_code: "389", country_code: "MK"},
    {phone_code: "261", country_code: "MG"},
    {phone_code: "265", country_code: "MW"},
    {phone_code: "60", country_code: "MY"},
    {phone_code: "960", country_code: "MV"},
    {phone_code: "223", country_code: "ML"},
    {phone_code: "356", country_code: "MT"},
    {phone_code: "692", country_code: "MH"},
    {phone_code: "222", country_code: "MR"},
    {phone_code: "230", country_code: "MU"},
    {phone_code: "262", country_code: "YT"},
    {phone_code: "52", country_code: "MX"},
    {phone_code: "691", country_code: "FM"},
    {phone_code: "373", country_code: "MD"},
    {phone_code: "377", country_code: "MC"},
    {phone_code: "976", country_code: "MN"},
    {phone_code: "382", country_code: "ME"},
    {phone_code: "1-664", country_code: "MS"},
    {phone_code: "212", country_code: "MA"},
    {phone_code: "258", country_code: "MZ"},
    {phone_code: "95", country_code: "MM"},
    {phone_code: "264", country_code: "NA"},
    {phone_code: "674", country_code: "NR"},
    {phone_code: "977", country_code: "NP"},
    {phone_code: "31", country_code: "NL"},
    {phone_code: "599", country_code: "AN"},
    {phone_code: "687", country_code: "NC"},
    {phone_code: "64", country_code: "NZ"},
    {phone_code: "505", country_code: "NI"},
    {phone_code: "227", country_code: "NE"},
    {phone_code: "234", country_code: "NG"},
    {phone_code: "683", country_code: "NU"},
    {phone_code: "850", country_code: "KP"},
    {phone_code: "1-670", country_code: "MP"},
    {phone_code: "47", country_code: "NO"},
    {phone_code: "968", country_code: "OM"},
    {phone_code: "92", country_code: "PK"},
    {phone_code: "680", country_code: "PW"},
    {phone_code: "970", country_code: "PS"},
    {phone_code: "507", country_code: "PA"},
    {phone_code: "675", country_code: "PG"},
    {phone_code: "595", country_code: "PY"},
    {phone_code: "51", country_code: "PE"},
    {phone_code: "63", country_code: "PH"},
    {phone_code: "64", country_code: "PN"},
    {phone_code: "48", country_code: "PL"},
    {phone_code: "351", country_code: "PT"},
    {phone_code: "1-787", country_code: "PR"},
    {phone_code: "974", country_code: "QA"},
    {phone_code: "242", country_code: "CG"},
    {phone_code: "262", country_code: "RE"},
    {phone_code: "40", country_code: "RO"},
    {phone_code: "7", country_code: "RU"},
    {phone_code: "250", country_code: "RW"},
    {phone_code: "590", country_code: "BL"},
    {phone_code: "290", country_code: "SH"},
    {phone_code: "1-869", country_code: "KN"},
    {phone_code: "1-758", country_code: "LC"},
    {phone_code: "590", country_code: "MF"},
    {phone_code: "508", country_code: "PM"},
    {phone_code: "1-784", country_code: "VC"},
    {phone_code: "685", country_code: "WS"},
    {phone_code: "378", country_code: "SM"},
    {phone_code: "239", country_code: "ST"},
    {phone_code: "966", country_code: "SA"},
    {phone_code: "221", country_code: "SN"},
    {phone_code: "381", country_code: "RS"},
    {phone_code: "248", country_code: "SC"},
    {phone_code: "232", country_code: "SL"},
    {phone_code: "65", country_code: "SG"},
    {phone_code: "1-721", country_code: "SX"},
    {phone_code: "421", country_code: "SK"},
    {phone_code: "386", country_code: "SI"},
    {phone_code: "677", country_code: "SB"},
    {phone_code: "252", country_code: "SO"},
    {phone_code: "27", country_code: "ZA"},
    {phone_code: "82", country_code: "KR"},
    {phone_code: "211", country_code: "SS"},
    {phone_code: "34", country_code: "ES"},
    {phone_code: "94", country_code: "LK"},
    {phone_code: "249", country_code: "SD"},
    {phone_code: "597", country_code: "SR"},
    {phone_code: "47", country_code: "SJ"},
    {phone_code: "268", country_code: "SZ"},
    {phone_code: "46", country_code: "SE"},
    {phone_code: "41", country_code: "CH"},
    {phone_code: "963", country_code: "SY"},
    {phone_code: "886", country_code: "TW"},
    {phone_code: "992", country_code: "TJ"},
    {phone_code: "255", country_code: "TZ"},
    {phone_code: "66", country_code: "TH"},
    {phone_code: "228", country_code: "TG"},
    {phone_code: "690", country_code: "TK"},
    {phone_code: "676", country_code: "TO"},
    {phone_code: "1-868", country_code: "TT"},
    {phone_code: "216", country_code: "TN"},
    {phone_code: "90", country_code: "TR"},
    {phone_code: "993", country_code: "TM"},
    {phone_code: "1-649", country_code: "TC"},
    {phone_code: "688", country_code: "TV"},
    {phone_code: "1-340", country_code: "VI"},
    {phone_code: "256", country_code: "UG "},
    {phone_code: "380", country_code: "UA"},
    {phone_code: "971", country_code: "AE"},
    {phone_code: "44", country_code: "GB"},
    {phone_code: "1", country_code: "US"},
    {phone_code: "598", country_code: "UY"},
    {phone_code: "998", country_code: "UZ"},
    {phone_code: "678", country_code: "VU"},
    {phone_code: "379", country_code: "VA"},
    {phone_code: "58", country_code: "VE"},
    {phone_code: "84", country_code: "VN"},
    {phone_code: "681", country_code: "WF"},
    {phone_code: "212", country_code: "EH"},
    {phone_code: "967", country_code: "YE"},
    {phone_code: "260", country_code: "ZM"},
    {phone_code: "263", country_code: "ZW"}
];
let allCountries = [];
getCountries();

function init() {
    console.log("here");
    $('select').select2({
        placeholder: 'Select an option'
    });
}

function getCountries() {
    $.ajax(
        ajaxUrlToGetAllCountries,
        {
            type: 'GET',
            headers: {
                'X-CSRF-Token': csrfToken
            },
            success: function (data, status, xhr) {
                if (status == "success") {
                    allCountries = data.countries;
                    initCountrySelector();
                    initPhoneNumberSelector();
                }
            }
        }
    );
}

function initCountrySelector() {
    let options = [];
    allCountries.forEach(country => {
        let { id, code, title } = country;
        options.push({
            id: id,
            text: title,
            html: `<span class="flag-icon flag-icon-${code.toLowerCase()} mr-1"></span>${title}`
        });
    });
    $(".gjs-country-selector").select2({
        data: options,
        templateResult: function(data) {
            return data.html
        },
        templateSelection: function(data) {
            return data.html;
        },
        escapeMarkup: function(markup) {
            return markup;
        }
    })
}

function initPhoneNumberSelector() {
    initMask();
    let options = [];
    allCountries.forEach(country => {
        let { code } = country;
        let phone_item = country_phone_match.find(it => {
            return it.country_code.toLowerCase() == code.toLowerCase()
        });
        if (phone_item) {
            options.push({
                id: code,
                text: phone_item.phone_code,
                html: `<span class="flag-icon flag-icon-${code.toLowerCase()} mr-1"></span>+${phone_item?phone_item.phone_code:''}`
            });
        }
    });
    $(".country-code-selector").select2({
        minimumResultsForSearch: -1,
        data: options,
        templateResult: function(data) {
            return data.html
        },
        templateSelection: function(data) {
            return data.html;
        },
        escapeMarkup: function(markup) {
            return markup;
        }
    })
}


function initMask() {
    (function( jQuery, window, undefined ) {
        "use strict";
        var matched, browser;
        jQuery.uaMatch = function( ua ) {
            ua = ua.toLowerCase();
            var match = /(opr)[\/]([\w.]+)/.exec( ua ) ||
                /(chrome)[ \/]([\w.]+)/.exec( ua ) ||
                /(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec( ua ) ||
                /(webkit)[ \/]([\w.]+)/.exec( ua ) ||
                /(opera)(?:.*version|)[ \/]([\w.]+)/.exec( ua ) ||
                /(msie) ([\w.]+)/.exec( ua ) ||
                ua.indexOf("trident") >= 0 && /(rv)(?::| )([\w.]+)/.exec( ua ) ||
                ua.indexOf("compatible") < 0 && /(mozilla)(?:.*? rv:([\w.]+)|)/.exec( ua ) ||
                [];

            var platform_match = /(ipad)/.exec( ua ) ||
                /(iphone)/.exec( ua ) ||
                /(android)/.exec( ua ) ||
                /(windows phone)/.exec( ua ) ||
                /(win)/.exec( ua ) ||
                /(mac)/.exec( ua ) ||
                /(linux)/.exec( ua ) ||
                /(cros)/i.exec( ua ) ||
                [];

            return {
                browser: match[ 3 ] || match[ 1 ] || "",
                version: match[ 2 ] || "0",
                platform: platform_match[ 0 ] || ""
            };
        };

        matched = jQuery.uaMatch( window.navigator.userAgent );
        browser = {};

        if ( matched.browser ) {
            browser[ matched.browser ] = true;
            browser.version = matched.version;
            browser.versionNumber = parseInt(matched.version);
        }

        if ( matched.platform ) {
            browser[ matched.platform ] = true;
        }

        if ( browser.android || browser.ipad || browser.iphone || browser[ "windows phone" ] ) {
            browser.mobile = true;
        }

        if ( browser.cros || browser.mac || browser.linux || browser.win ) {
            browser.desktop = true;
        }

        if ( browser.chrome || browser.opr || browser.safari ) {
            browser.webkit = true;
        }

        if ( browser.rv ) {
            var ie = "msie";
            matched.browser = ie;
            browser[ie] = true;
        }

        if ( browser.opr ) {
            var opera = "opera";
            matched.browser = opera;
            browser[opera] = true;
        }

        if ( browser.safari && browser.android ) {
            var android = "android";
            matched.browser = android;
            browser[android] = true;
        }

        browser.name = matched.browser;
        browser.platform = matched.platform;
        jQuery.browser = browser;
    })( jQuery, window );
    (function(a){var b=(a.browser.msie?"paste":"input")+".mask",c=window.orientation!=undefined;a.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn"},a.fn.extend({caret:function(a,b){if(this.length!=0){if(typeof a=="number"){b=typeof b=="number"?b:a;return this.each(function(){if(this.setSelectionRange)this.setSelectionRange(a,b);else if(this.createTextRange){var c=this.createTextRange();c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",a),c.select()}})}if(this[0].setSelectionRange)a=this[0].selectionStart,b=this[0].selectionEnd;else if(document.selection&&document.selection.createRange){var c=document.selection.createRange();a=0-c.duplicate().moveStart("character",-1e5),b=a+c.text.length}return{begin:a,end:b}}},unmask:function(){return this.trigger("unmask")},mask:function(d,e){if(!d&&this.length>0){var f=a(this[0]);return f.data(a.mask.dataName)()}e=a.extend({placeholder:"_",completed:null},e);var g=a.mask.definitions,h=[],i=d.length,j=null,k=d.length;a.each(d.split(""),function(a,b){b=="?"?(k--,i=a):g[b]?(h.push(new RegExp(g[b])),j==null&&(j=h.length-1)):h.push(null)});return this.trigger("unmask").each(function(){function v(a){var b=f.val(),c=-1;for(var d=0,g=0;d<k;d++)if(h[d]){l[d]=e.placeholder;while(g++<b.length){var m=b.charAt(g-1);if(h[d].test(m)){l[d]=m,c=d;break}}if(g>b.length)break}else l[d]==b.charAt(g)&&d!=i&&(g++,c=d);if(!a&&c+1<i)f.val(""),t(0,k);else if(a||c+1>=i)u(),a||f.val(f.val().substring(0,c+1));return i?d:j}function u(){return f.val(l.join("")).val()}function t(a,b){for(var c=a;c<b&&c<k;c++)h[c]&&(l[c]=e.placeholder)}function s(a){var b=a.which,c=f.caret();if(a.ctrlKey||a.altKey||a.metaKey||b<32)return!0;if(b){c.end-c.begin!=0&&(t(c.begin,c.end),p(c.begin,c.end-1));var d=n(c.begin-1);if(d<k){var g=String.fromCharCode(b);if(h[d].test(g)){q(d),l[d]=g,u();var i=n(d);f.caret(i),e.completed&&i>=k&&e.completed.call(f)}}return!1}}function r(a){var b=a.which;if(b==8||b==46||c&&b==127){var d=f.caret(),e=d.begin,g=d.end;g-e==0&&(e=b!=46?o(e):g=n(e-1),g=b==46?n(g):g),t(e,g),p(e,g-1);return!1}if(b==27){f.val(m),f.caret(0,v());return!1}}function q(a){for(var b=a,c=e.placeholder;b<k;b++)if(h[b]){var d=n(b),f=l[b];l[b]=c;if(d<k&&h[d].test(f))c=f;else break}}function p(a,b){if(!(a<0)){for(var c=a,d=n(b);c<k;c++)if(h[c]){if(d<k&&h[c].test(l[d]))l[c]=l[d],l[d]=e.placeholder;else break;d=n(d)}u(),f.caret(Math.max(j,a))}}function o(a){while(--a>=0&&!h[a]);return a}function n(a){while(++a<=k&&!h[a]);return a}var f=a(this),l=a.map(d.split(""),function(a,b){if(a!="?")return g[a]?e.placeholder:a}),m=f.val();f.data(a.mask.dataName,function(){return a.map(l,function(a,b){return h[b]&&a!=e.placeholder?a:null}).join("")}),f.attr("readonly")||f.one("unmask",function(){f.unbind(".mask").removeData(a.mask.dataName)}).bind("focus.mask",function(){m=f.val();var b=v();u();var c=function(){b==d.length?f.caret(0,b):f.caret(b)};(a.browser.msie?c:function(){setTimeout(c,0)})()}).bind("blur.mask",function(){v(),f.val()!=m&&f.change()}).bind("keydown.mask",r).bind("keypress.mask",s).bind(b,function(){setTimeout(function(){f.caret(v(!0))},0)}),v()})}})})(jQuery);

    /*     My Javascript      */
    $(function(){
        $("#phone_number").mask("(999) 999-9999");
        $("#phone_number").on("blur", function() {
            var last = $(this).val().substr( $(this).val().indexOf("-") + 1 );

            if( last.length == 5 ) {
                var move = $(this).val().substr( $(this).val().indexOf("-") + 1, 1 );

                var lastfour = last.substr(1,4);

                var first = $(this).val().substr( 0, 9 );

                $(this).val( first + move + '-' + lastfour );
            }
        });
    });
}
